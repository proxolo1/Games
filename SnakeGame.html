<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <script src="https://kit.fontawesome.com/776c2e42dc.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <div class="m-4">
        <canvas id="canvas" width="600" height="600" style="border:2px solid black;"></canvas>
        <div style="position:absolute; top: 120px; right:400px;">
            <h1><i class="fas fa-gamepad"></i> Score : <span id="score"></span></h1>
        </div>
        <button onclick="moveSnake()">start</button>
    </div>
    <script>
        const canvas = document.getElementById("canvas")
        const ctx = canvas.getContext("2d")
        let snakeW = snakeH = 10
        let canvasW = canvas.width
        let canvasH = canvas.height
        let dx, dy, foodX, foodY, interval, snake, leftPressed, rightPressed, upPressed, downPressed, score,head
        initializeVariables()
        drawSnake()
        //moveSnake()
        drawFood()
        randomPosition()
        snakeNavigation()
        function drawSnake() {

            snake.forEach((snake) => {
                ctx.beginPath();
                ctx.rect(snake.x, snake.y, snakeW, snakeH)
                ctx.fillStyle = 'black'
                ctx.fill()
                ctx.closePath()
            })
        }
        function moveSnake() {
            if (!interval) {
                interval = setInterval(() => {
                    handleDirection()
                    detectCollision()
                    head = { x: snake[0].x + dx, y: snake[0].y + dy }
                    snake.unshift(head)
                    snake.pop()
                    //snake.forEach(snake => snake.x += 2)
                    ctx.clearRect(0, 0, canvasW, canvasH)
                    drawSnake()
                    drawFood()
                    growSnakes()

                }, 80)
            }
        }
        function snakeNavigation() {
            document.addEventListener('keydown', handleKeyDown)
            document.addEventListener('keyup', handleKeyUp)
            function handleKeyDown(e) {
                if (e.key === 'ArrowDown') { downPressed = true }
                if (e.key === 'ArrowUp') { upPressed = true }
                if (e.key === 'ArrowLeft') { leftPressed = true }
                if (e.key === 'ArrowRight') { rightPressed = true }
            }
            function handleKeyUp(e) {
                if (e.key === 'ArrowDown') { downPressed = false }
                if (e.key === 'ArrowUp') { upPressed = false }
                if (e.key === 'ArrowLeft') { leftPressed = false }
                if (e.key === 'ArrowRight') { rightPressed = false }
            }
        }
        function handleDirection() {
            if (downPressed) {
                dy = snakeW
                dx = 0
            }
            if (rightPressed) {
                dx = snakeW
                dy = 0
            }
            if (leftPressed) {
                dx = -snakeW
                dy = 0
            }
            if (upPressed) {
                dy = -snakeW
                dx = 0
            }
            
        }
        function randomPosition() {
            foodX = Math.floor(Math.random() * (canvasW-100) / 10) * 10
            foodY = Math.floor(Math.random() * (canvasH-100) / 10) * 10
            console.log(foodX, foodY)
        }
        function drawFood() {
            ctx.beginPath()
            ctx.rect(foodX, foodY, snakeW, snakeH)
            ctx.fillStyle = "green"
            ctx.fill()
            ctx.closePath()
        }
        function growSnakes() {
            if (snake[0].x === foodX && snake[0].y === foodY) {
                snake.push({ x: foodX, y: foodY })
                randomPosition()
                score += 1
                document.getElementById('score').innerHTML = score
            }
        }
        function detectCollision() {
            if (snake[0].x >= canvasW || snake[0].x <= 0 || snake[0].y >= canvasH || snake[0].y <= 0) {
               // alert('game over')
                reset()
            }
            snake.forEach((snake)=>{
                console.log(snake.x)
                console.log(head)
            })
        }
        function reset() {
            clearInterval(interval)
            initializeVariables()
            randomPosition()
         //   moveSnake()


        }
        function initializeVariables() {
            snake = [
                { x: 20, y: 10 }
            ]
            interval = null
            dx = snakeW
            dy = 0
            leftPressed = rightPressed = upPressed = downPressed = false
            score = 0
            document.getElementById("score").innerHTML = score
        }
    </script>
</body>

</html>
